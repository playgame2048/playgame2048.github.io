<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Block Puzzle</title>

<style>
:root{
  --bg:#f2f2f2;
  --text:#111;
  --card:#fff;
}
body.dark{
  --bg:#121212;
  --text:#eee;
  --card:#1e1e1e;
}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  text-align:center;
  overscroll-behavior:none;
}

header{padding:10px}

#score{
  font-size:20px;
  font-weight:bold;
}

canvas{
  background:#ddd;
  border-radius:10px;
  margin:15px auto 5px;
  display:block;
}

.controls-under{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-bottom:10px;
}

button{
  padding:8px 14px;
  cursor:pointer;
  font-size:16px;
  touch-action:manipulation;
}

.mobile{
  display:none;
  justify-content:center;
  gap:18px;
  margin:10px 0;
}

.mobile button{
  font-size:26px;
  padding:14px 18px;
}

@media (max-width: 768px){
  .mobile{display:flex;}
}

.blog{
  max-width:600px;
  margin:25px auto;
  padding:20px;
  background:var(--card);
  border-radius:10px;
  text-align:left;
  font-size:16px;
}
.blog h2{text-align:center}

#gameOver{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  color:#fff;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  font-size:24px;
}

footer{font-size:12px;margin:10px}
</style>
</head>

<body>

<header>
  <h1>üß© Block Puzzle</h1>
  <div id="score">Score: 0</div>
</header>

<canvas id="game" width="300" height="400"></canvas>

<!-- buttons under grid -->
<div class="controls-under">
  <button type="button" onclick="restartGame()">üîÇ Restart</button>
  <button type="button" onclick="toggleDark()">üåô Dark Mode</button>
</div>

<!-- mobile controls -->
<div class="mobile">
  <button type="button" onclick="rotate(event)">‚¨ÜÔ∏è</button>
  <button type="button" onclick="move(-1,event)">‚¨ÖÔ∏è</button>
  <button type="button" onclick="drop(event)">‚¨áÔ∏è</button>
  <button type="button" onclick="move(1,event)">‚û°Ô∏è</button>
</div>

<section class="blog">
  <h2>How to Play</h2>
  <ul>
    <li>Move blocks left or right</li>
    <li>Rotate blocks using the up button</li>
    <li>Complete full rows to clear them</li>
    <li>Blocks above fall down automatically</li>
    <li>Game ends when the grid is full</li>
  </ul>
</section>

<footer>¬© 2026 Block Puzzle</footer>

<div id="gameOver">
  <div>Game Over</div>
  <button type="button" onclick="restartGame()">‚ôªÔ∏è Restart</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

const COLS=15, ROWS=20;
const SIZE=canvas.width/COLS;

let grid,current,score=0,gameOver=false;
let restartClickedOnce=false;

const scoreEl=document.getElementById("score");
const overBox=document.getElementById("gameOver");

// üîó ÿ®ÿØŸëŸÑ ÿ∫Ÿäÿ± ŸáÿßÿØ ÿßŸÑÿ±ÿßÿ®ÿ∑
const AFFILIATE_LINK="PUT_YOUR_MONETAG_LINK_HERE";

const SHAPES=[
 {shape:[[1,1],[1,1]], color:"#f44336"},
 {shape:[[1,1,1,1]], color:"#2196f3"},
 {shape:[[1,0],[1,0],[1,1]], color:"#4caf50"},
 {shape:[[0,1],[0,1],[1,1]], color:"#ff9800"},
 {shape:[[1,1,0],[0,1,1]], color:"#9c27b0"}
];

function emptyGrid(){
  return Array.from({length:ROWS},()=>Array(COLS).fill(null));
}

function newBlock(){
  const b=SHAPES[Math.floor(Math.random()*SHAPES.length)];
  return{
    x:6,y:0,
    shape:JSON.parse(JSON.stringify(b.shape)),
    color:b.color
  };
}

function rotate(e){
  if(e) e.preventDefault();
  if(gameOver) return;
  const r=current.shape[0].map((_,i)=>current.shape.map(row=>row[i]).reverse());
  const old=current.shape;
  current.shape=r;
  if(collide()) current.shape=old;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      ctx.fillStyle=grid[y][x]||"#bbb";
      ctx.fillRect(x*SIZE,y*SIZE,SIZE-1,SIZE-1);
    }
  }
  ctx.fillStyle=current.color;
  current.shape.forEach((row,y)=>{
    row.forEach((v,x)=>{
      if(v){
        ctx.fillRect((current.x+x)*SIZE,(current.y+y)*SIZE,SIZE-1,SIZE-1);
      }
    });
  });
}

function collide(){
  return current.shape.some((row,y)=>
    row.some((v,x)=>{
      if(!v)return false;
      let ny=current.y+y, nx=current.x+x;
      return ny>=ROWS||nx<0||nx>=COLS||grid[ny][nx];
    })
  );
}

function merge(){
  current.shape.forEach((row,y)=>{
    row.forEach((v,x)=>{
      if(v) grid[current.y+y][current.x+x]=current.color;
    });
  });
}

function clearLines(){
  for(let y=ROWS-1;y>=0;y--){
    if(grid[y].every(c=>c)){
      grid.splice(y,1);
      grid.unshift(Array(COLS).fill(null));
      score+=10;
      y++;
    }
  }
  scoreEl.textContent="Score: "+score;
}

function drop(e){
  if(e) e.preventDefault();
  if(gameOver) return;
  current.y++;
  if(collide()){
    current.y--;
    merge();
    clearLines();
    current=newBlock();
    if(collide()){
      gameOver=true;
      overBox.style.display="flex";
    }
  }
}

function move(dir,e){
  if(e) e.preventDefault();
  if(gameOver) return;
  current.x+=dir;
  if(collide()) current.x-=dir;
}

document.addEventListener("keydown",e=>{
  if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))
    e.preventDefault();
  if(e.key==="ArrowLeft")move(-1);
  if(e.key==="ArrowRight")move(1);
  if(e.key==="ArrowDown")drop();
  if(e.key==="ArrowUp")rotate();
});

function restartGame(){
  if(!restartClickedOnce){
    restartClickedOnce=true;
    window.open(AFFILIATE_LINK,"_blank");
    return;
  }
  start();
}

function start(){
  grid=emptyGrid();
  current=newBlock();
  score=0;
  gameOver=false;
  scoreEl.textContent="Score: 0";
  overBox.style.display="none";
}

function toggleDark(){
  document.body.classList.toggle("dark");
}

start();
setInterval(()=>{drop();draw();},700);
</script>

</body>
</html>
